# 麻将游戏 - 使用说明

## 游戏简介

这是一个基于Web的局域网麻将游戏，支持1-4人游戏，可以添加机器人AI补足人数。游戏采用简化的麻将规则，适合快速对局。

## 功能特性

### 核心功能
- ✅ **多人对战**：支持1-4人同时游戏
- ✅ **机器人AI**：可添加智能机器人补足4人
- ✅ **轮数设置**：可选择1-4轮游戏
- ✅ **实时同步**：基于WebSocket的实时游戏同步
- ✅ **分数统计**：自动计算和显示玩家分数

### 游戏规则

#### 基本规则
1. **玩家数量**：必须4人才能开始游戏
2. **轮数规则**：一轮 = 4个人都当过庄家（每人做一次庄）
3. **发牌规则**：每人发13张牌，庄家14张
4. **游戏流程**：
   - 庄家先打牌
   - 按顺序摸牌、打牌
   - 满足胡牌条件可以胡牌
   - 一人胡牌，本局结束

#### 胡牌条件（简化规则）
满足以下任一条件即可胡牌：

1. **标准胡牌**：一对将（2张相同的牌）+ 4组顺子/刻子
   - 顺子：3张连续的同花色牌（如：1万2万3万）
   - 刻子：3张相同的牌（如：3条3条3条）

2. **七对子**：7对相同的牌

#### 计分规则
- 基础分：10分
- 七对子：加倍（20分）
- 自摸：加倍
- 自摸胜利：赢家+分×3，其他3人各-分
- 点炮胜利：赢家+分，点炮者-分

## 如何运行

### 1. 启动应用

```bash
# 使用Maven启动
mvn spring-boot:run

# 或者先编译再运行
mvn clean package
java -jar target/my-app-1.0-SNAPSHOT.jar
```

### 2. 访问游戏

打开浏览器访问：
```
http://localhost:8080/mahjong.html
```

### 3. 局域网多人游戏

在局域网内，其他玩家可以通过主机IP访问：
```
http://[主机IP]:8080/mahjong.html
```

例如：`http://192.168.1.100:8080/mahjong.html`

## 游戏操作指南

### 游戏设置（开始前）

1. **添加机器人**
   - 点击"添加机器人"按钮
   - 可以添加1-3个机器人
   - 机器人会自动进行游戏

2. **设置轮数**
   - 选择游戏轮数（1-4轮）
   - 默认为1轮

3. **开始游戏**
   - 确保有4名玩家（真人+机器人）
   - 点击"开始游戏"按钮

### 游戏中操作

1. **打牌**
   - 轮到你时，手牌会高亮显示
   - 点击要打出的牌
   - 系统会自动处理摸牌和打牌

2. **胡牌**
   - 满足胡牌条件时，"胡牌"按钮会激活
   - 点击"胡牌"按钮声明胡牌
   - 系统会自动计算分数

3. **查看信息**
   - 当前轮次：显示在游戏信息区
   - 剩余牌数：实时更新
   - 玩家手牌：只能看到自己的手牌
   - 打出的牌：所有玩家的打出牌都可见

### 游戏结束

1. **单局结束**
   - 有人胡牌时，显示胜者和得分
   - 点击"下一局"继续游戏

2. **游戏结束**
   - 所有轮次完成后显示最终排名
   - 显示所有玩家的总分

## 技术架构

### 后端技术
- **Spring Boot 2.7.18**：应用框架
- **WebSocket**：实时通信
- **Lombok**：简化Java代码
- **Jackson**：JSON序列化

### 前端技术
- **HTML5**：页面结构
- **CSS3**：样式设计
- **JavaScript**：游戏逻辑
- **WebSocket API**：实时通信

### 核心组件

#### 后端
- `MahjongTile`：麻将牌实体
- `MahjongPlayer`：玩家实体
- `MahjongRoom`：游戏房间
- `MahjongGameService`：游戏逻辑服务
- `MahjongBotService`：机器人AI服务
- `MahjongWebSocketHandler`：WebSocket处理器

#### 前端
- `mahjong.html`：游戏界面
- WebSocket客户端：处理实时通信
- 游戏状态管理：维护游戏状态

## 项目结构

```
src/main/java/com/jeizas/
├── model/mahjong/
│   ├── MahjongTile.java          # 麻将牌
│   ├── MahjongPlayer.java        # 玩家
│   ├── MahjongRoom.java          # 房间
│   └── MahjongMessage.java       # 消息
├── service/
│   ├── MahjongGameService.java   # 游戏逻辑
│   └── MahjongBotService.java    # 机器人AI
├── websocket/
│   └── MahjongWebSocketHandler.java  # WebSocket处理
└── config/
    └── WebSocketConfig.java      # WebSocket配置

src/main/resources/static/
└── mahjong.html                  # 游戏前端页面
```

## 注意事项

1. **浏览器兼容性**：建议使用现代浏览器（Chrome、Firefox、Edge等）
2. **网络要求**：需要WebSocket支持
3. **同时只能有一个房间**：目前版本使用默认房间，所有玩家进入同一房间
4. **机器人AI**：机器人会自动思考1-3秒后行动，模拟真人
5. **断线重连**：玩家断线后会自动尝试重连

## 扩展功能建议

如需扩展，可以考虑：
- 多房间支持
- 更复杂的麻将规则（吃、碰、杠等）
- 聊天功能
- 战绩统计
- 用户系统
- 观战模式

## 故障排除

### 问题：无法连接WebSocket
**解决方案**：
- 检查服务器是否正常运行
- 确认端口8080未被占用
- 检查防火墙设置

### 问题：游戏无法开始
**解决方案**：
- 确保有4名玩家
- 检查浏览器控制台是否有错误
- 刷新页面重试

### 问题：机器人不行动
**解决方案**：
- 等待1-3秒（机器人思考时间）
- 检查后端日志是否有异常

## 开发者信息

- 作者：jeizas
- 日期：2025-12-07
- 框架：Spring Boot
- 协议：开源

## 更新日志

### v1.0.0 (2025-12-07)
- ✅ 初始版本发布
- ✅ 支持4人麻将游戏
- ✅ 机器人AI功能
- ✅ 简化麻将规则
- ✅ 实时WebSocket通信
- ✅ 分数统计功能
